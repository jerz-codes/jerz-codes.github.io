<!DOCTYPE html>
<html lang="pl-pl">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>ZajÄ™cia 15: TrochÄ™matrix, czyli ulepszony Biedamatrix | jerz.codes</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Roboto+Mono&family=Roboto:wght@400;700&display=swap">
    <link rel="stylesheet" href="/css/style.css" />
    <link rel="stylesheet" href="/css/fonts.css" />
    
  </head>

  <body>
    <nav>
    <ul class="menu">
      
      <li><a href="/">ğŸ </a></li>
      
      <li><a href="/zapisy/">Zapisy</a></li>
      
      <li><a href="/faq/">FAQ</a></li>
      
      <li><a href="/kontakt/">Kontakt</a></li>
      
    </ul>
    <hr/>
    </nav>

<div class="article-meta">
<h1><span class="title">ZajÄ™cia 15: TrochÄ™matrix, czyli ulepszony Biedamatrix</span></h1>

<h2 class="date">2023/02/21</h2>
</div>

<main>
<div>
    <nav id="TableOfContents">
  <ul>
    <li><a href="#sytuacja-po-poprzednich-zajÄ™ciach">Sytuacja po poprzednich zajÄ™ciach</a></li>
    <li><a href="#bug-nr-1-mruganie">Bug nr 1: mruganie</a></li>
    <li><a href="#zmiana-nr-2-przedwczesne-znikanie">Zmiana nr 2: przedwczesne znikanie</a></li>
    <li><a href="#zmiana-nr-3-paleta-kolorÃ³w-smugi">Zmiana nr 3: paleta kolorÃ³w smugi</a></li>
    <li><a href="#podsumowanie">Podsumowanie</a></li>
  </ul>
</nav>
</div>
<h1 id="sytuacja-po-poprzednich-zajÄ™ciach">Sytuacja po poprzednich zajÄ™ciach</h1>
<p>Pod koniec poprzednich zajÄ™Ä‡ nasz Biedamatrix prezentowaÅ‚ siÄ™ nastÄ™pujÄ…co:</p>
<p><img src="biedamatrix.png" alt=""></p>
<p>Najbardziej paskudny bug w naszym programie nie jest widoczny na nieruchomym obrazku, ale dziaÅ‚ajÄ…ca animacja &ldquo;mruga&rdquo;. Tym zajmiemy siÄ™ w pierwszej kolejnoÅ›ci.</p>
<p>Kolejne zmiany bÄ™dÄ… dotyczyÅ‚y smug za literkami:</p>
<ul>
<li>Smugi nie powinny znikaÄ‡, gdy litera doleci do dolnej krawÄ™dzi ekranu.</li>
<li>Litery w smudze powinny stopniowo Å›ciemniaÄ‡ siÄ™ ku gÃ³rze.</li>
</ul>
<h1 id="bug-nr-1-mruganie">Bug nr 1: mruganie</h1>
<p>Uproszczony kod naszego programu wyglÄ…da mniej-wiÄ™cej tak:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-text" data-lang="text"><span style="display:flex;"><span>do {
</span></span><span style="display:flex;"><span>  wyczyÅ›Ä‡ ekran
</span></span><span style="display:flex;"><span>  
</span></span><span style="display:flex;"><span>  dla kaÅ¼dej z 42 literek:
</span></span><span style="display:flex;"><span>    zmieÅ„ kolor na biaÅ‚y
</span></span><span style="display:flex;"><span>    przesuÅ„ kursor
</span></span><span style="display:flex;"><span>    narysuj literkÄ™ na dole smugi
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    zmieÅ„ kolor na zielony
</span></span><span style="display:flex;"><span>    powtÃ³rz 10 razy:
</span></span><span style="display:flex;"><span>      przesuÅ„ kursor
</span></span><span style="display:flex;"><span>      narysuj literkÄ™ w smudze
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  poczekaj 100ms
</span></span><span style="display:flex;"><span>} while(true)
</span></span></code></pre></div><p>KaÅ¼da instrukcja w powyÅ¼szym pseudokodzie sprowadza siÄ™ do wywoÅ‚ania funkcji <code>print</code>. Tak wiÄ™c jeszcze bardziej uproszczony pseudokod wyglÄ…da nastÄ™pujÄ…co:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-text" data-lang="text"><span style="display:flex;"><span>do {
</span></span><span style="display:flex;"><span>  wyczyÅ›Ä‡ ekran (czyli print nr 1)
</span></span><span style="display:flex;"><span>  wypisz resztÄ™ (czyli pozostaÅ‚e ~1000 printÃ³w)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  poczekaj 100ms
</span></span><span style="display:flex;"><span>} while(true)
</span></span></code></pre></div><p>Po kaÅ¼dym wywoÅ‚aniu instrukcji <code>print</code> nasz program daje znaÄ‡ oknu terminala, Å¼e pojawiÅ‚y siÄ™ nowe rzeczy, ktÃ³re bardzo chciaÅ‚by wyÅ›wietliÄ‡. Dzieje siÄ™ to ok. 1000 razy w jednym przebiegu pÄ™tli, ktÃ³ra wykonuje siÄ™ 10 razy na sekundÄ™. Sumarycznie, nasz program chciaÅ‚by odÅ›wieÅ¼yÄ‡ zawartoÅ›Ä‡ okienka ok. 10 tysiÄ™cy razy na sekundÄ™.</p>
<p>Ekran waszego komputera nie jest w stanie tego obsÅ‚uÅ¼yÄ‡. Standardowe ekrany potrafiÄ… pokazaÄ‡ 60 klatek na sekundÄ™, czyli odÅ›wieÅ¼ajÄ… obraz co ok. 16ms (bo <code>1000ms / 60 = 16.66(6)ms</code>).</p>
<p>Dialog miÄ™dzy ekranem komputera i naszym programem wyglÄ…da nastÄ™pujÄ…co:</p>
<blockquote>
<p><strong>Program</strong>: Popatrz! Popatrz! Patrz, jakie super rzeczy mam!</p>
<p><strong>Ekran</strong>: â€¦</p>
<p><strong>Program</strong>: No weÅº, popatrz tylko!</p>
<p><strong>Program</strong>: O, znowu coÅ› mam! WyÅ›wietlisz?</p>
<p><strong>Ekran</strong>: Nie-e. ZajÄ™ty jestemâ€¦</p>
<p><strong>Program</strong>: Szkoda. O, popatrz! Nowe rzeczy!</p>
<p><em>Po kilkunastu milisekundach</em></p>
<p><strong>Program</strong>: Znowu coÅ› mam! I znowu! O, znowu-znowu!</p>
<p><strong>Ekran</strong>: No dobra, daj toâ€¦</p>
<p><strong>Program</strong>: DziÄ™ki, ty to fajny jesteÅ›! A to mi wyÅ›wietlisz? A to? O, i to jeszcze?</p>
</blockquote>
<p>Nie kontrolujemy tego, kiedy ekran bÄ™dzie w stanie (albo bÄ™dzie Å‚askaw) wyÅ›wietliÄ‡ to, co da mu program. Czasami wydarzy siÄ™ to po wypisaniu wszystkich liter, gdy program czeka na nastÄ™pny przebieg pÄ™tli w wywoÅ‚aniu <code>Thread.sleep(100)</code>, i wtedy wszystko wyÅ›wietli siÄ™ poprawnie. MoÅ¼e siÄ™ teÅ¼ zdarzyÄ‡ tak, Å¼e ekran postanowi siÄ™ odÅ›wieÅ¼yÄ‡ tuÅ¼ po <code>print(Ansi.wyczyÅ›Ä‡Ekran())</code> i przez kolejnych 16ms bÄ™dzie wyÅ›wietlony czarny ekran. To wÅ‚aÅ›nie jest ÅºrÃ³dÅ‚em &ldquo;mrugania&rdquo;.</p>
<p>Nie jesteÅ›my (jeszczeâ€¦) w stanie dopasowaÄ‡ siÄ™ do czÄ™stotliwoÅ›ci odÅ›wieÅ¼ania ekranu, ale moÅ¼emy obejÅ›Ä‡ ten problem w inny sposÃ³b: zamiast bombardowaÄ‡ okno tysiÄ…cami <code>print</code>Ã³w, moÅ¼emy kaÅ¼dÄ… klatkÄ™ animacji najpierw przygotowaÄ‡, a dopiero pÃ³Åºniej przekazaÄ‡ do wyÅ›wietlenia w jednym <code>print</code>.</p>
<p>Na poczÄ…tku pÄ™tli stworzymy pustÄ… zmiennÄ… z tekstem, zamienimy wszystkie <code>print</code>y na dodawanie kolejnych elementÃ³w do tej zmiennej, i dopiero na samym koÅ„cu pÄ™tli wyÅ›wietlimy caÅ‚Ä… klatkÄ™ animacji <code>print</code>em:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-diff" data-lang="diff"><span style="display:flex;"><span>do {
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">+   var kartka = &#34;&#34;
</span></span></span><span style="display:flex;"><span><span style="color:#a6e22e"></span> 
</span></span><span style="display:flex;"><span><span style="color:#f92672">-   print(Ansi.wyczyÅ›Ä‡Ekran())
</span></span></span><span style="display:flex;"><span><span style="color:#f92672"></span><span style="color:#a6e22e">+   kartka += Ansi.wyczyÅ›Ä‡Ekran()
</span></span></span><span style="display:flex;"><span><span style="color:#a6e22e"></span>
</span></span><span style="display:flex;"><span>    for (litera in litery) {
</span></span><span style="display:flex;"><span>        if (litera.y &gt; 0) {
</span></span><span style="display:flex;"><span>            // narysuj biaÅ‚Ä… literkÄ™
</span></span><span style="display:flex;"><span><span style="color:#f92672">-           print(Ansi.kolorCzcionki(Color.WHITE))
</span></span></span><span style="display:flex;"><span><span style="color:#f92672">-           print(Ansi.przesuÅ„Kursor(litera.x, litera.y))
</span></span></span><span style="display:flex;"><span><span style="color:#f92672">-           print(znaki.random())
</span></span></span><span style="display:flex;"><span><span style="color:#f92672"></span><span style="color:#a6e22e">+           kartka += Ansi.kolorCzcionki(Color.WHITE)
</span></span></span><span style="display:flex;"><span><span style="color:#a6e22e">+           kartka += Ansi.przesuÅ„Kursor(litera.x, litera.y)
</span></span></span><span style="display:flex;"><span><span style="color:#a6e22e">+           kartka += znaki.random()
</span></span></span><span style="display:flex;"><span><span style="color:#a6e22e"></span>
</span></span><span style="display:flex;"><span>            // narysuj zielonÄ… smugÄ™
</span></span><span style="display:flex;"><span><span style="color:#f92672">-           print(Ansi.kolorCzcionki(Color.GREEN))
</span></span></span><span style="display:flex;"><span><span style="color:#f92672"></span><span style="color:#a6e22e">+           kartka += Ansi.kolorCzcionki(Color.GREEN)
</span></span></span><span style="display:flex;"><span><span style="color:#a6e22e"></span>            for (dy in 1..DÅUGOÅšÄ†_SMUGI) {
</span></span><span style="display:flex;"><span>                val ySmugi = litera.y - dy
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>                if (ySmugi &gt; 0) {
</span></span><span style="display:flex;"><span><span style="color:#f92672">-                   print(Ansi.przesuÅ„Kursor(litera.x, ySmugi))
</span></span></span><span style="display:flex;"><span><span style="color:#f92672">-                   print(znaki.random())
</span></span></span><span style="display:flex;"><span><span style="color:#f92672"></span><span style="color:#a6e22e">+                   kartka += Ansi.przesuÅ„Kursor(litera.x, ySmugi)
</span></span></span><span style="display:flex;"><span><span style="color:#a6e22e">+                   kartka += znaki.random()
</span></span></span><span style="display:flex;"><span><span style="color:#a6e22e"></span>                }
</span></span><span style="display:flex;"><span>            }
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>        litera.y += 1
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        if (litera.y &gt; WYSOKOSC) {
</span></span><span style="display:flex;"><span>            litera.x = (1..SZEROKOSC).random()
</span></span><span style="display:flex;"><span>            litera.y = 1
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">+   print(kartka)
</span></span></span><span style="display:flex;"><span><span style="color:#a6e22e"></span>    Thread.sleep(100)
</span></span><span style="display:flex;"><span>} while (true)
</span></span></code></pre></div><p>Ta technika nazywana jest <a href="https://pl.wikipedia.org/wiki/Bufor_ramki">buforowaniem ramki</a> i jest powszechnie stosowana w grach komputerowych.</p>
<h1 id="zmiana-nr-2-przedwczesne-znikanie">Zmiana nr 2: przedwczesne znikanie</h1>
<p>W obecnej wersji programu, literki &ldquo;teleportujÄ…&rdquo; siÄ™ na gÃ³rÄ™ ekranu, gdy tylko dotknÄ… dolnej krawÄ™dzi. To zachowanie sprawia, Å¼e smuga, ktÃ³ra byÅ‚a rysowana ponad tÄ… literkÄ…, nagle zniknie, zamiast podÄ…Å¼yÄ‡ za literkÄ… poza dolnÄ… krawÄ™dÅº.</p>
<p>Najprostszym rozwiÄ…zaniem tego problemu bÄ™dzie opÃ³Åºnienie przenoszenia litery do momentu, gdy caÅ‚a smuga znajdzie siÄ™ poza ekranem, czyli gdy wspÃ³Å‚rzÄ™dna <code>y</code> litery bÄ™dzie wiÄ™ksza niÅ¼ <code>(WYSOKOSC + DÅUGOÅšÄ†_SMUGI)</code>:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-diff" data-lang="diff"><span style="display:flex;"><span><span style="color:#f92672">-       if (litera.y &gt; WYSOKOSC) {
</span></span></span><span style="display:flex;"><span><span style="color:#f92672"></span><span style="color:#a6e22e">+       if (litera.y &gt; (WYSOKOSC + DÅUGOÅšÄ†_SMUGI)) {
</span></span></span><span style="display:flex;"><span><span style="color:#a6e22e"></span>            litera.x = (1..SZEROKOSC).random()
</span></span><span style="display:flex;"><span>            litera.y = 1
</span></span><span style="display:flex;"><span>        }
</span></span></code></pre></div><p>Ta zmiana spowoduje pojawienie siÄ™ innego efektu, ktÃ³ry nie wyglÄ…da najlepiej: litery bÄ™dÄ… spadaÄ‡ &ldquo;falami&rdquo;, z doÅ›Ä‡ dobrze zauwaÅ¼alnÄ… przerwÄ… pomiÄ™dzy (jeÅ›li nie widaÄ‡ tego efektu w waszym programie, moÅ¼ecie zwiÄ™kszyÄ‡ liczbÄ™ animowanych liter).</p>
<p>Chcemy, aby litery byÅ‚y mniej-wiÄ™cej rÃ³wnomiernie rozsiane po ekranie. MoÅ¼na wylosowaÄ‡ ich poczÄ…tkowÄ… pozycjÄ™ z zakresu widocznego na ekranie:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-text" data-lang="text"><span style="display:flex;"><span>+---------------------------+     ^
</span></span><span style="display:flex;"><span>|    a         j    d    c  |     | 
</span></span><span style="display:flex;"><span>|    A      b  J    D    c  |     |
</span></span><span style="display:flex;"><span>| f         b            C  |     |  
</span></span><span style="display:flex;"><span>| f    e    B         g     |     | WYSOKOÅšÄ†
</span></span><span style="display:flex;"><span>| F    e        i     g h   |     |
</span></span><span style="display:flex;"><span>|      E        i     G h   |     |
</span></span><span style="display:flex;"><span>|               I       H   |     |
</span></span><span style="display:flex;"><span>+---------------------------+     V
</span></span></code></pre></div><p>ChcieliÅ›my teÅ¼, aby poczÄ…tkowo ekran byÅ‚ czarny, a litery pojawiaÅ‚y siÄ™ stopniowo zza jego gÃ³rnej krawÄ™dzi. Å»eby to osiÄ…gnÄ…Ä‡, losowaliÅ›my <code>y</code> z przedziaÅ‚u <code>-WYSOKOÅšÄ†..-1</code>:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-text" data-lang="text"><span style="display:flex;"><span>                                  ^ -WYSOKOÅšÄ†
</span></span><span style="display:flex;"><span>     A         J    D             | 
</span></span><span style="display:flex;"><span>                         C        |
</span></span><span style="display:flex;"><span>            B                     |  
</span></span><span style="display:flex;"><span>  F                               | 
</span></span><span style="display:flex;"><span>       E              G           |
</span></span><span style="display:flex;"><span>                I       H         |
</span></span><span style="display:flex;"><span>+---------------------------+     - 0
</span></span><span style="display:flex;"><span>|                           |     | 
</span></span><span style="display:flex;"><span>|                           |     |
</span></span><span style="display:flex;"><span>|                           |     |  
</span></span><span style="display:flex;"><span>|                           |     | 
</span></span><span style="display:flex;"><span>|                           |     |
</span></span><span style="display:flex;"><span>|                           |     |
</span></span><span style="display:flex;"><span>|                           |     | WYSOKOÅšÄ†
</span></span><span style="display:flex;"><span>+---------------------------+     V
</span></span></code></pre></div><p>Czyli przesunÄ™liÅ›my obszar rysowania na ujemnÄ… poÅ‚owÄ™ naszego ukÅ‚adu wspÃ³Å‚rzÄ™dnych. Gdy zmieniliÅ›my moment, w ktÃ³rym przenosimy literÄ™ na gÃ³rÄ™ ekranu, zmieniliÅ›my teÅ¼ obszar rysowania: powiÄ™kszyliÅ›my go o <code>DÅUGOÅšÄ†_SMUGI</code> linii:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-text" data-lang="text"><span style="display:flex;"><span>+---------------------------+     - 0
</span></span><span style="display:flex;"><span>|                           |     |
</span></span><span style="display:flex;"><span>|    a         j    d       |     |
</span></span><span style="display:flex;"><span>|    a         j    d    c  |     | 
</span></span><span style="display:flex;"><span>|    A      b  J    D    c  |     |
</span></span><span style="display:flex;"><span>| f         b            C  |     |  
</span></span><span style="display:flex;"><span>| f    e    B         g     |     | 
</span></span><span style="display:flex;"><span>| F    e        i     g h   |     - WYSOKOÅšÄ†
</span></span><span style="display:flex;"><span>+---------------------------+     |
</span></span><span style="display:flex;"><span>       E        i     G h         |
</span></span><span style="display:flex;"><span>                I       H         |  
</span></span><span style="display:flex;"><span>                                  V WYSOKOÅšÄ† + DÅUGOÅšÄ†_SMUGI
</span></span></code></pre></div><p>Å»eby zachowaÄ‡ rÃ³wnomierny rozrzut liter, musimy tak samo poszerzyÄ‡ obszar, na ktÃ³ry bÄ™dziemy je poczÄ…tkowo rozmieszczaÄ‡:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-diff" data-lang="diff"><span style="display:flex;"><span>    for (i in 1..42) {
</span></span><span style="display:flex;"><span>        litery.add(
</span></span><span style="display:flex;"><span>            Litera(
</span></span><span style="display:flex;"><span>                x = (1..SZEROKOSC).random(),
</span></span><span style="display:flex;"><span><span style="color:#f92672">-               y = (-WYSOKOSC..-1).random()
</span></span></span><span style="display:flex;"><span><span style="color:#f92672"></span><span style="color:#a6e22e">+               y = (-(WYSOKOSC + DÅUGOSC_SMUGI)..-1).random()
</span></span></span><span style="display:flex;"><span><span style="color:#a6e22e"></span>            )
</span></span><span style="display:flex;"><span>        )
</span></span><span style="display:flex;"><span>    }
</span></span></code></pre></div><h1 id="zmiana-nr-3-paleta-kolorÃ³w-smugi">Zmiana nr 3: paleta kolorÃ³w smugi</h1>
<p>SpadajÄ…ca literka powinna byÄ‡ narysowana na biaÅ‚o i pozostawiaÄ‡ za sobÄ… zielonÄ…, stopniowo ciemniejÄ…cÄ… smugÄ™. Obecnie nasza pÄ™tla rysujÄ…ca smugÄ™ wyglÄ…da tak:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-kotlin" data-lang="kotlin"><span style="display:flex;"><span><span style="color:#75715e">// narysuj zielonÄ… smugÄ™
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>kartka <span style="color:#f92672">+=</span> <span style="color:#a6e22e">Ansi</span>.kolorCzcionki(<span style="color:#a6e22e">Color</span>.GREEN)
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">for</span> (dy <span style="color:#66d9ef">in</span> <span style="color:#ae81ff">1.</span>.<span style="color:#ae81ff">10</span>) {
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">val</span> ySmugi = litera.y - dy
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">if</span> (ySmugi &gt; <span style="color:#ae81ff">0</span>) {
</span></span><span style="display:flex;"><span>        kartka <span style="color:#f92672">+=</span> <span style="color:#a6e22e">Ansi</span>.przesuÅ„Kursor(litera.x, ySmugi)
</span></span><span style="display:flex;"><span>        kartka <span style="color:#f92672">+=</span> znaki.random()
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p>Skoro kaÅ¼da literka ma mieÄ‡ inny kolor, powinniÅ›my przenieÅ›Ä‡ zmianÄ™ koloru czcionki tuÅ¼ przed dodawaniem do kartki znaczka. Kolor, ktÃ³rego uÅ¼yjemy, bÄ™dzie zaleÅ¼aÅ‚ od tego, ktÃ³rÄ… literkÄ™ bÄ™dziemy wypisywaÄ‡. MoÅ¼emy wykorzystaÄ‡ fakt, Å¼e jesteÅ›my wewnÄ…trz pÄ™tli po przedziale <code>1..10</code>, wiÄ™c staÅ‚a <code>dy</code> bÄ™dzie wskazywaÄ‡ na to, ktÃ³rÄ… literkÄ… wÅ‚aÅ›nie siÄ™ zajmujemy. NajproÅ›ciej bÄ™dzie przed gÅ‚Ã³wnÄ… pÄ™tlÄ… animacji przygotowaÄ‡ sobie paletÄ™ barw, czyli 10-elementowÄ… listÄ™ <code>Color</code>:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-kotlin" data-lang="kotlin"><span style="display:flex;"><span><span style="color:#66d9ef">val</span> kolory = mutableListOf&lt;Color&gt;()
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">for</span> (i <span style="color:#66d9ef">in</span> <span style="color:#ae81ff">1.</span>.<span style="color:#ae81ff">10</span>) {
</span></span><span style="display:flex;"><span>    kolory.add(<span style="color:#75715e">/* tym zajmiejmy siÄ™ za chwilkÄ™ */</span>)
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p>PamiÄ™tajcie, Å¼e listy indeksowane sÄ… od <code>0</code>, a nasza staÅ‚a <code>dy</code> bÄ™dzie przybieraÄ‡ wartoÅ›ci z przedziaÅ‚u od <code>1..10</code>! WyciÄ…gajÄ…c kolor dla elementu <code>dy</code> bÄ™dziemy musieli poprosiÄ‡ o kolor pod indeksem <code>dy - 1</code>.</p>
<p>Po wszystkich zmianach nasza pÄ™tla rysujÄ…ca smugÄ™ bÄ™dzie wyglÄ…daÄ‡ tak:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-kotlin" data-lang="kotlin"><span style="display:flex;"><span><span style="color:#75715e">// narysuj zielonÄ… smugÄ™
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#66d9ef">for</span> (dy <span style="color:#66d9ef">in</span> <span style="color:#ae81ff">1.</span>.<span style="color:#ae81ff">10</span>) {
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">val</span> ySmugi = litera.y - dy
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">if</span> (ySmugi &gt; <span style="color:#ae81ff">0</span>) {
</span></span><span style="display:flex;"><span>        kartka <span style="color:#f92672">+=</span> <span style="color:#a6e22e">Ansi</span>.przesuÅ„Kursor(litera.x, ySmugi)
</span></span><span style="display:flex;"><span>        kartka <span style="color:#f92672">+=</span> <span style="color:#a6e22e">Ansi</span>.kolorCzcionki(kolory[dy - <span style="color:#ae81ff">1</span>])
</span></span><span style="display:flex;"><span>        kartka <span style="color:#f92672">+=</span> znaki.random()
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p>OstatniÄ… rzeczÄ…, ktÃ³rÄ… musimy zrobiÄ‡, jest stworzenie palety kolorÃ³w, czyli dopisanie kodu w miejscu, gdzie teraz mamy komentarz <code>/* tym zajmiejmy siÄ™ za chwilkÄ™ */</code>.</p>
<p>Zazwyczaj tworzÄ…c obiekty typu <code>Color</code> przy uÅ¼yciu jego standardowego konstruktora, podawaliÅ›my skÅ‚adowÄ… czerwonÄ…, zielonÄ…, i niebieskÄ…. Nie jest to jedyny sposÃ³b, moÅ¼na teÅ¼ stworzyÄ‡ <code>Color</code> funkcjÄ… <code>Color.getHSBColor(â€¦)</code> podajÄ…c jego barwÄ™ (<em>Hue</em>), nasycenie (<em>Saturation</em>) i jasnoÅ›Ä‡ (<em>Brightness</em>).</p>
<p>Wszystkie wartoÅ›ci powinny byÄ‡ liczbami rzeczywistymi z przedziaÅ‚u <code>0..1</code>. W Kotlinie liczby rzeczywiste to typ <code>Float</code>. Å»eby stworzyÄ‡ liczbÄ™ <code>Float</code> zamiast <code>Int</code>a, musimy do wartoÅ›ci dodaÄ‡ literkÄ™ <code>f</code>:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-kotlin" data-lang="kotlin"><span style="display:flex;"><span><span style="color:#66d9ef">val</span> liczbaCaÅ‚kowita: Int = <span style="color:#ae81ff">1500</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">val</span> liczbaRzeczywista: Float = <span style="color:#ae81ff">2900f</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">val</span> trzyCzwarte: Float = <span style="color:#ae81ff">0.75f</span>
</span></span></code></pre></div><p>W przypadku nasycenia i jasnoÅ›ci moÅ¼na to interpretowaÄ‡ jako procentowÄ… wartoÅ›Ä‡: nasycenie <code>1f</code> to w 100% jaskrawa barwa; nasycenie <code>0.4f</code> to inaczej 40% nasycenia, czyli bardziej pastelowy kolor.</p>
<p>Barwa teÅ¼ jest liczbÄ… od <code>0f</code> do <code>1f</code>, przy czym jej zachowanie moÅ¼e byÄ‡ trochÄ™ zaskakujÄ…ce. WartoÅ›Ä‡ <code>0f</code> odpowiada kolorowi czerwonemu. WiÄ™ksze wartoÅ›ci odpowiadajÄ… kolejnym kolorom tÄ™czy: <code>0.16f</code> to bÄ™dzie kolor Å¼Ã³Å‚ty, <code>0.33f</code> to kolor zielony, <code>0.66f</code> to niebieski, <code>0.82f</code> to fioletowy itd. WartoÅ›ci pomiÄ™dzy oczywiÅ›cie teÅ¼ moÅ¼na uÅ¼ywaÄ‡, na przykÅ‚ad przedziaÅ‚ pomiÄ™dzy <code>0f</code> a <code>0.16f</code> to rÃ³Å¼ne odcienie pomaraÅ„czowego.</p>
<p>MyÅ›lÄ™, Å¼e najlepiej bÄ™dzie pokazaÄ‡ przy uÅ¼yciu krÃ³tkiego programu testowego, ktÃ³ry pokazuje caÅ‚Ä… paletÄ™ jaskrawych barw, zaczynajÄ…c od czerwonego <code>0f</code> po lewej stronie.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-kotlin" data-lang="kotlin"><span style="display:flex;"><span><span style="color:#66d9ef">fun</span> <span style="color:#a6e22e">main</span>() = terminal(
</span></span><span style="display:flex;"><span>    widthInTiles = <span style="color:#ae81ff">60</span>,
</span></span><span style="display:flex;"><span>    heightInTiles = <span style="color:#ae81ff">1</span>,
</span></span><span style="display:flex;"><span>) {
</span></span><span style="display:flex;"><span>   <span style="color:#66d9ef">for</span> (i <span style="color:#66d9ef">in</span> <span style="color:#ae81ff">1.</span>.<span style="color:#ae81ff">60</span>) {
</span></span><span style="display:flex;"><span>       <span style="color:#66d9ef">val</span> kolor = <span style="color:#a6e22e">Color</span>.getHSBColor(
</span></span><span style="display:flex;"><span>           (i - <span style="color:#ae81ff">1</span>).toFloat() / <span style="color:#ae81ff">60f</span>,
</span></span><span style="display:flex;"><span>           <span style="color:#ae81ff">1f</span>,
</span></span><span style="display:flex;"><span>           <span style="color:#ae81ff">1f</span>
</span></span><span style="display:flex;"><span>       )
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>       print(<span style="color:#a6e22e">Ansi</span>.kolorCzcionki(kolor))
</span></span><span style="display:flex;"><span>       print(<span style="color:#e6db74">&#34;#&#34;</span>)
</span></span><span style="display:flex;"><span>   }
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p><img src="tecza.png" alt="tÄ™cza"></p>
<p>WracajÄ…c do naszego Matrixa: chcemy stworzyÄ‡ paletÄ™ zielonych, stopniowo ciemniejÄ…cych kolorÃ³w. Zamiast Å¼onglowaÄ‡ wartoÅ›ciami RGB, moÅ¼emy uÅ¼yÄ‡ modelu HSB. Litery majÄ… byÄ‡ zielone (<code>h = 0.33f</code>) i nasycone (<code>s = 1f</code>), natomiast ich jasnoÅ›Ä‡ ma stopniowo maleÄ‡ do zera:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-kotlin" data-lang="kotlin"><span style="display:flex;"><span><span style="color:#66d9ef">val</span> kolory = mutableListOf&lt;Color&gt;()
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">for</span> (i <span style="color:#66d9ef">in</span> <span style="color:#ae81ff">1.</span>.<span style="color:#ae81ff">10</span>) {
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">val</span> b = <span style="color:#ae81ff">1f</span> - (i - <span style="color:#ae81ff">1</span>) * <span style="color:#ae81ff">0.1f</span>
</span></span><span style="display:flex;"><span>    kolory.add(<span style="color:#a6e22e">Color</span>.getHSBColor(<span style="color:#ae81ff">0.33f</span>, <span style="color:#ae81ff">1f</span>, b))
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><h1 id="podsumowanie">Podsumowanie</h1>
<p>Uff, dobrnÄ™liÅ›my do koÅ„ca. Po wszystkich zmianach nasz Matrix prezentuje siÄ™ znacznie lepiej: nic nie mruga, nie ma glitchy, smugi Å‚adnie zanikajÄ…. To juÅ¼ nie Biedamatrix, ale&hellip; TrochÄ™matrix?</p>
<p><img src="trochematrix.png" alt="TrochÄ™matrix"></p>
<p>Na nastÄ™pnych zajÄ™ciach zostawimy Matrixa w spokoju i zajmiemy siÄ™ kolejnÄ… animacjÄ… pt.: &ldquo;Doom Fire&rdquo;, czyli bÄ™dziemy podpalaÄ‡ ekrany naszych komputerÃ³w.</p>

</main>

  <footer>
  
  
  </footer>
  </body>
</html>

