<!DOCTYPE html>
<html lang="pl-pl">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>ZajÄ™cia 16: Doom Fire | jerz.codes</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Roboto+Mono&family=Roboto:wght@400;700&display=swap">
    <link rel="stylesheet" href="/css/style.css" />
    <link rel="stylesheet" href="/css/fonts.css" />
    
  </head>

  <body>
    <nav>
    <ul class="menu">
      
      <li><a href="/">ğŸ </a></li>
      
      <li><a href="/zapisy/">Zapisy</a></li>
      
      <li><a href="/faq/">FAQ</a></li>
      
      <li><a href="/kontakt/">Kontakt</a></li>
      
    </ul>
    <hr/>
    </nav>

<div class="article-meta">
<h1><span class="title">ZajÄ™cia 16: Doom Fire</span></h1>

<h2 class="date">2023/02/28</h2>
</div>

<main>
<div>
    <nav id="TableOfContents">
  <ul>
    <li><a href="#okienko">Okienko</a></li>
    <li><a href="#paleta-kolorÃ³w">Paleta kolorÃ³w</a></li>
    <li><a href="#model-danych">Model danych</a></li>
    <li><a href="#rysowanie-ekranu">Rysowanie ekranu</a></li>
    <li><a href="#pÄ™tla-animacji">PÄ™tla animacjiâ€¦</a></li>
    <li><a href="#i-faktyczna-animacja">â€¦i faktyczna animacja!</a></li>
    <li><a href="#doom-tÄ™cza">Doomâ€¦ tÄ™cza?</a></li>
  </ul>
</nav>
</div>
<p>Na poprzednich zajÄ™ciach animowaliÅ›my Matrix&rsquo;owy deszcz liter. DziÅ› pobawimy siÄ™ w piromanÃ³w i napiszemy animacjÄ™ pÅ‚omieni.</p>
<h1 id="okienko">Okienko</h1>
<p>Podobnie, jak przy Matrix&rsquo;owych animacjach, zaczniemy od narysowania pustego okienka. UÅ¼yjemy staÅ‚ych do okreÅ›lenia szerokoÅ›ci i wysokoÅ›ci okna â€“ bÄ™dziemy potrzebowaÄ‡ tych wartoÅ›ci pÃ³Åºniej. Do rysowania pÅ‚omieni nie bÄ™dziemy uÅ¼ywaÄ‡ Å¼adnych specjalnych znaczkÃ³w. Zamiast tego bÄ™dziemy wypisywaÄ‡ rÃ³Å¼nokolorowe spacje, a wiÄ™c kaÅ¼dy znak naszego terminala bÄ™dzie osobnym pikselem (doÅ›Ä‡ sporym i prostokÄ…tnym, ale wciÄ…Å¼ pikselem). Nasze okno powinno byÄ‡ zatem duÅ¼y, a rozmiar czcionki â€“ maÅ‚y:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-kotlin" data-lang="kotlin"><span style="display:flex;"><span><span style="color:#66d9ef">val</span> SZEROKOSC = <span style="color:#ae81ff">120</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">val</span> WYSOKOSC = <span style="color:#ae81ff">80</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">fun</span> <span style="color:#a6e22e">main</span>() = terminal(
</span></span><span style="display:flex;"><span>    widthInTiles = SZEROKOSC,
</span></span><span style="display:flex;"><span>    heightInTiles = WYSOKOSC,
</span></span><span style="display:flex;"><span>    fontSize = <span style="color:#ae81ff">8</span>
</span></span><span style="display:flex;"><span>) {
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><h1 id="paleta-kolorÃ³w">Paleta kolorÃ³w</h1>
<p>W przypadku Matrix&rsquo;owych animacji paletÄ™ kolorÃ³w dla smug ciÄ…gnÄ…cych siÄ™ za spadajÄ…cymi tworzyliÅ›my samodzielnie. W dzisiejszym programie wykorzystamy paletÄ™ z gry Doom z 1993 roku. MoÅ¼ecie wkleiÄ‡ poniÅ¼szy fragment przed funkcjÄ… <code>main</code>:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-kotlin" data-lang="kotlin"><span style="display:flex;"><span><span style="color:#66d9ef">val</span> PALETA = listOf(
</span></span><span style="display:flex;"><span>    Color(<span style="color:#ae81ff">0x07</span>, <span style="color:#ae81ff">0x07</span>, <span style="color:#ae81ff">0x07</span>),
</span></span><span style="display:flex;"><span>    Color(<span style="color:#ae81ff">0x1f</span>, <span style="color:#ae81ff">0x07</span>, <span style="color:#ae81ff">0x07</span>),
</span></span><span style="display:flex;"><span>    Color(<span style="color:#ae81ff">0x2f</span>, <span style="color:#ae81ff">0x0f</span>, <span style="color:#ae81ff">0x07</span>),
</span></span><span style="display:flex;"><span>    Color(<span style="color:#ae81ff">0x47</span>, <span style="color:#ae81ff">0x0f</span>, <span style="color:#ae81ff">0x07</span>),
</span></span><span style="display:flex;"><span>    Color(<span style="color:#ae81ff">0x57</span>, <span style="color:#ae81ff">0x17</span>, <span style="color:#ae81ff">0x07</span>),
</span></span><span style="display:flex;"><span>    Color(<span style="color:#ae81ff">0x67</span>, <span style="color:#ae81ff">0x1f</span>, <span style="color:#ae81ff">0x07</span>),
</span></span><span style="display:flex;"><span>    Color(<span style="color:#ae81ff">0x77</span>, <span style="color:#ae81ff">0x1f</span>, <span style="color:#ae81ff">0x07</span>),
</span></span><span style="display:flex;"><span>    Color(<span style="color:#ae81ff">0x8f</span>, <span style="color:#ae81ff">0x27</span>, <span style="color:#ae81ff">0x07</span>),
</span></span><span style="display:flex;"><span>    Color(<span style="color:#ae81ff">0x9f</span>, <span style="color:#ae81ff">0x2f</span>, <span style="color:#ae81ff">0x07</span>),
</span></span><span style="display:flex;"><span>    Color(<span style="color:#ae81ff">0xaf</span>, <span style="color:#ae81ff">0x3f</span>, <span style="color:#ae81ff">0x07</span>),
</span></span><span style="display:flex;"><span>    Color(<span style="color:#ae81ff">0xbf</span>, <span style="color:#ae81ff">0x47</span>, <span style="color:#ae81ff">0x07</span>),
</span></span><span style="display:flex;"><span>    Color(<span style="color:#ae81ff">0xc7</span>, <span style="color:#ae81ff">0x47</span>, <span style="color:#ae81ff">0x07</span>),
</span></span><span style="display:flex;"><span>    Color(<span style="color:#ae81ff">0xDF</span>, <span style="color:#ae81ff">0x4F</span>, <span style="color:#ae81ff">0x07</span>),
</span></span><span style="display:flex;"><span>    Color(<span style="color:#ae81ff">0xDF</span>, <span style="color:#ae81ff">0x57</span>, <span style="color:#ae81ff">0x07</span>),
</span></span><span style="display:flex;"><span>    Color(<span style="color:#ae81ff">0xDF</span>, <span style="color:#ae81ff">0x57</span>, <span style="color:#ae81ff">0x07</span>),
</span></span><span style="display:flex;"><span>    Color(<span style="color:#ae81ff">0xD7</span>, <span style="color:#ae81ff">0x5F</span>, <span style="color:#ae81ff">0x07</span>),
</span></span><span style="display:flex;"><span>    Color(<span style="color:#ae81ff">0xD7</span>, <span style="color:#ae81ff">0x67</span>, <span style="color:#ae81ff">0x0F</span>),
</span></span><span style="display:flex;"><span>    Color(<span style="color:#ae81ff">0xcf</span>, <span style="color:#ae81ff">0x6f</span>, <span style="color:#ae81ff">0x0f</span>),
</span></span><span style="display:flex;"><span>    Color(<span style="color:#ae81ff">0xcf</span>, <span style="color:#ae81ff">0x77</span>, <span style="color:#ae81ff">0x0f</span>),
</span></span><span style="display:flex;"><span>    Color(<span style="color:#ae81ff">0xcf</span>, <span style="color:#ae81ff">0x7f</span>, <span style="color:#ae81ff">0x0f</span>),
</span></span><span style="display:flex;"><span>    Color(<span style="color:#ae81ff">0xCF</span>, <span style="color:#ae81ff">0x87</span>, <span style="color:#ae81ff">0x17</span>),
</span></span><span style="display:flex;"><span>    Color(<span style="color:#ae81ff">0xC7</span>, <span style="color:#ae81ff">0x87</span>, <span style="color:#ae81ff">0x17</span>),
</span></span><span style="display:flex;"><span>    Color(<span style="color:#ae81ff">0xC7</span>, <span style="color:#ae81ff">0x8F</span>, <span style="color:#ae81ff">0x17</span>),
</span></span><span style="display:flex;"><span>    Color(<span style="color:#ae81ff">0xC7</span>, <span style="color:#ae81ff">0x97</span>, <span style="color:#ae81ff">0x1F</span>),
</span></span><span style="display:flex;"><span>    Color(<span style="color:#ae81ff">0xBF</span>, <span style="color:#ae81ff">0x9F</span>, <span style="color:#ae81ff">0x1F</span>),
</span></span><span style="display:flex;"><span>    Color(<span style="color:#ae81ff">0xBF</span>, <span style="color:#ae81ff">0x9F</span>, <span style="color:#ae81ff">0x1F</span>),
</span></span><span style="display:flex;"><span>    Color(<span style="color:#ae81ff">0xBF</span>, <span style="color:#ae81ff">0xA7</span>, <span style="color:#ae81ff">0x27</span>),
</span></span><span style="display:flex;"><span>    Color(<span style="color:#ae81ff">0xBF</span>, <span style="color:#ae81ff">0xA7</span>, <span style="color:#ae81ff">0x27</span>),
</span></span><span style="display:flex;"><span>    Color(<span style="color:#ae81ff">0xBF</span>, <span style="color:#ae81ff">0xAF</span>, <span style="color:#ae81ff">0x2F</span>),
</span></span><span style="display:flex;"><span>    Color(<span style="color:#ae81ff">0xB7</span>, <span style="color:#ae81ff">0xAF</span>, <span style="color:#ae81ff">0x2F</span>),
</span></span><span style="display:flex;"><span>    Color(<span style="color:#ae81ff">0xB7</span>, <span style="color:#ae81ff">0xB7</span>, <span style="color:#ae81ff">0x2F</span>),
</span></span><span style="display:flex;"><span>    Color(<span style="color:#ae81ff">0xB7</span>, <span style="color:#ae81ff">0xB7</span>, <span style="color:#ae81ff">0x37</span>),
</span></span><span style="display:flex;"><span>    Color(<span style="color:#ae81ff">0xCF</span>, <span style="color:#ae81ff">0xCF</span>, <span style="color:#ae81ff">0x6F</span>),
</span></span><span style="display:flex;"><span>    Color(<span style="color:#ae81ff">0xDF</span>, <span style="color:#ae81ff">0xDF</span>, <span style="color:#ae81ff">0x9F</span>),
</span></span><span style="display:flex;"><span>    Color(<span style="color:#ae81ff">0xEF</span>, <span style="color:#ae81ff">0xEF</span>, <span style="color:#ae81ff">0xC7</span>),
</span></span><span style="display:flex;"><span>    Color(<span style="color:#ae81ff">0xFF</span>, <span style="color:#ae81ff">0xFF</span>, <span style="color:#ae81ff">0xFF</span>),
</span></span><span style="display:flex;"><span>)
</span></span></code></pre></div><h1 id="model-danych">Model danych</h1>
<p>Dla kaÅ¼dego &ldquo;piksela&rdquo; na naszym ekranie bÄ™dziemy przechowywaÄ‡ jej &ldquo;poziom ciepÅ‚a&rdquo;: liczbÄ™ od 0 do 35. Te liczby nie wziÄ™Å‚y siÄ™ z kosmosu: mamy dokÅ‚adnie 36 barw w naszej palecie, wiÄ™c liczby <code>0..35</code> odpowiadajÄ… indeksom w tej tablicy. Poziom <code>0</code> oznacza prawie caÅ‚kowicie wygaszonÄ… kratkÄ™, poziom <code>35</code> to kratka rozÅ¼arzona do biaÅ‚oÅ›ci.</p>
<p>ProponujÄ™ przechowywaÄ‡ te dane w zagnieÅ¼dÅ¼onej liÅ›cie, tj.: liÅ›cie linijek, gdzie kaÅ¼da linijka to lista poziomÃ³w ciepÅ‚a kratek w tej linii:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-kotlin" data-lang="kotlin"><span style="display:flex;"><span><span style="color:#66d9ef">val</span> ekran: MutableList&lt;MutableList&lt;Int&gt;&gt;
</span></span></code></pre></div><p>PoczÄ…tkowo musimy wypeÅ‚niÄ‡ wszystkie kratki wartoÅ›ciÄ… <code>0</code>, poza dolnÄ… liniÄ…, ktÃ³rÄ… wypeÅ‚nimy wartoÅ›ciami <code>35</code>. BÄ™dzie to ÅºrÃ³dÅ‚o ciepÅ‚a i pÅ‚omieni.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-kotlin" data-lang="kotlin"><span style="display:flex;"><span><span style="color:#66d9ef">for</span> (y <span style="color:#66d9ef">in</span> <span style="color:#ae81ff">1.</span>.WYSOKOSC) {
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">val</span> linijka = mutableListOf&lt;Int&gt;()
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">for</span> (x <span style="color:#66d9ef">in</span> <span style="color:#ae81ff">1.</span>.SZEROKOSC) {
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">val</span> pikselek = <span style="color:#66d9ef">if</span> (y <span style="color:#f92672">==</span> WYSOKOSC) <span style="color:#a6e22e">PALETA</span>.lastIndex <span style="color:#66d9ef">else</span> <span style="color:#ae81ff">0</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        linijka.add(pikselek)
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    ekran.add(linijka)
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p>W powyÅ¼szym fragmencie kodu sÄ… dwie rzeczy, na ktÃ³re chciaÅ‚bym zwrÃ³ciÄ‡ waszÄ… uwagÄ™.</p>
<p>Po pierwsze, dla ostatniej linijki zamiast po prostu wartoÅ›ci <code>35</code> uÅ¼ywamy wÅ‚asnoÅ›ci <code>PALETA.lastIndex</code>, czyli odpytujemy paletÄ™ barw o indeks ostatniego koloru. DziÄ™ki temu nawet po zmianie palety nasz program bÄ™dzie dziaÅ‚aÅ‚ poprawnie.</p>
<p>Po drugie, do staÅ‚ej <code>val pikselek</code> przypisujemy&hellip; <code>if..else</code>&lsquo;a? Taki manewr nie jest dozwolony w wielu jÄ™zykach programowania, ale akurat w Kotlinie <code>if..else</code> oraz <code>when</code> sÄ… <strong>wyraÅ¼eniami</strong>, czyli moÅ¼na ich uÅ¼ywaÄ‡ wszÄ™dzie tam, gdzie spodziewalibyÅ›my siÄ™ wywoÅ‚ania funkcji, uÅ¼ycia staÅ‚ej lub zmiennej, albo po prostu staÅ‚ej wartoÅ›ci wpisanej bezpoÅ›rednio w kodzie.</p>
<h1 id="rysowanie-ekranu">Rysowanie ekranu</h1>
<p>Skoro mamy juÅ¼ przygotowane dane dla caÅ‚ego ekranu, czas wyrysowaÄ‡ wszystko. Co prawda nie bÄ™dziemy jeszcze nic animowaÄ‡, ale nauczeni doÅ›wiadczeniem z tworzenia poprzednich animacji, zastosujemy trik z <code>kartkÄ…</code> i pojedynczym <code>print</code>, aby uniknÄ…Ä‡ pÃ³Åºniej mrugania ekranu:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-kotlin" data-lang="kotlin"><span style="display:flex;"><span><span style="color:#66d9ef">var</span> kartka = <span style="color:#e6db74">&#34;&#34;</span>
</span></span><span style="display:flex;"><span>kartka <span style="color:#f92672">+=</span> <span style="color:#a6e22e">Ansi</span>.wyczyÅ›Ä‡Ekran()
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">for</span> (y <span style="color:#66d9ef">in</span> <span style="color:#ae81ff">1.</span>.WYSOKOSC) {
</span></span><span style="display:flex;"><span>    kartka <span style="color:#f92672">+=</span> <span style="color:#a6e22e">Ansi</span>.przesuÅ„Kursor(<span style="color:#ae81ff">1</span>, y)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">val</span> linijka = ekran[y - <span style="color:#ae81ff">1</span>]
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">for</span> (x <span style="color:#66d9ef">in</span> <span style="color:#ae81ff">1.</span>.SZEROKOSC) {
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">val</span> pikselek = linijka[x - <span style="color:#ae81ff">1</span>]
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">val</span> kolorPiksela = PALETA[pikselek]
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        kartka <span style="color:#f92672">+=</span> <span style="color:#a6e22e">Ansi</span>.kolorTÅ‚a(kolorPiksela)
</span></span><span style="display:flex;"><span>        kartka <span style="color:#f92672">+=</span> <span style="color:#e6db74">&#39; &#39;</span>
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>print(kartka)
</span></span></code></pre></div><p>Wypisujemy ekran linijka po linijce, dla kaÅ¼dej linijki najpierw przechodzÄ…c na jej poczÄ…tek przy uÅ¼yciu <code>Ansi.przesuÅ„Kursor</code>, a potem rysujÄ…c rÃ³Å¼nokolorowÄ… spacjÄ™ dla kaÅ¼dego pikselka w linijce. JeÅ›li nie macie w swojej klasie <code>Ansi</code> metody <code>kolorTÅ‚a</code>, wrÃ³Ä‡cie do materiaÅ‚Ã³w z <a href="https://jerz.codes/posts/2022-12-20/">zajÄ™Ä‡ nr 9</a>.</p>
<p>ZauwaÅ¼cie teÅ¼, Å¼e pobierajÄ…c linijkÄ™ z listy <code>ekran</code> albo piksel z linijki, musimy od <code>y</code> i <code>x</code> odjÄ…Ä‡ <code>1</code>. Listy indeksowane sÄ… od <code>0</code>, a wiÄ™c dla pierwszego wiersza, czyli dla <code>y</code> rÃ³wnego <code>1</code>, musimy pobraÄ‡ <code>0</code>-wy element.</p>
<p>Po uruchomieniu programu powinniÅ›cie zobaczyÄ‡ czarne okienko z biaÅ‚Ä… kreskÄ… na dole:</p>
<p><img src="doom-kreska.png" alt="Doom kreska"></p>
<h1 id="pÄ™tla-animacji">PÄ™tla animacjiâ€¦</h1>
<p>Skoro mamy coÅ› animowaÄ‡, opakujmy rysowanie ekranu w pÄ™tlÄ™:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-kotlin" data-lang="kotlin"><span style="display:flex;"><span><span style="color:#66d9ef">do</span> {
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">var</span> kartka = <span style="color:#e6db74">&#34;&#34;</span>
</span></span><span style="display:flex;"><span>    kartka <span style="color:#f92672">+=</span> <span style="color:#a6e22e">Ansi</span>.wyczyÅ›Ä‡Ekran()
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">for</span> (y <span style="color:#66d9ef">in</span> <span style="color:#ae81ff">1.</span>.WYSOKOSC) {
</span></span><span style="display:flex;"><span>        kartka <span style="color:#f92672">+=</span> <span style="color:#a6e22e">Ansi</span>.przesuÅ„Kursor(<span style="color:#ae81ff">1</span>, y)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">val</span> linijka = ekran[y - <span style="color:#ae81ff">1</span>]
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">for</span> (x <span style="color:#66d9ef">in</span> <span style="color:#ae81ff">1.</span>.SZEROKOSC) {
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">val</span> pikselek = linijka[x - <span style="color:#ae81ff">1</span>]
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">val</span> kolorPiksela = PALETA[pikselek]
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>            kartka <span style="color:#f92672">+=</span> <span style="color:#a6e22e">Ansi</span>.kolorTÅ‚a(kolorPiksela)
</span></span><span style="display:flex;"><span>            kartka <span style="color:#f92672">+=</span> <span style="color:#e6db74">&#39; &#39;</span>
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    print(kartka)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">Thread</span>.sleep(<span style="color:#ae81ff">16</span>)
</span></span><span style="display:flex;"><span>    animujOgieÅ„(ekran)
</span></span><span style="display:flex;"><span>} <span style="color:#66d9ef">while</span> (<span style="color:#66d9ef">true</span>)
</span></span></code></pre></div><p>Po wyrysowaniu kartki dodaÅ‚em opÃ³Åºnienie przy uÅ¼yciu funkcji <code>Thread.sleep(â€¦)</code>. UÅ¼yta wartoÅ›Ä‡ <code>16</code> milisekund bierze siÄ™ z czÄ™stotliwoÅ›ci odÅ›wieÅ¼ania ekranu 99% nie-gameing&rsquo;owych monitorÃ³w, ktÃ³re sÄ… w stanie wyÅ›wietliÄ‡ 60 klatek na sekundÄ™ (<code>1000ms / 60 = 16.66(7)ms</code>). Nie ma sensu czÄ™Å›ciej wywoÅ‚ywaÄ‡ <code>print(kartka)</code> â€“ monitor i tak nie bÄ™dzie w stanie tego wyÅ›wietliÄ‡.</p>
<p>Ostatnia rzecz w gÅ‚Ã³wnej pÄ™tli animacji to wywoÅ‚anie funkcji <code>animujOgieÅ„</code>. To wÅ‚aÅ›nie ona bÄ™dzie &ldquo;sercem&rdquo; naszego programu. PrzekaÅ¼emy tam <code>ekran</code> i wewnÄ…trz tej funkcji bÄ™dziemy dokonywaÄ‡ w nim zmian, ktÃ³re sprawiÄ…, Å¼e nasze pÅ‚omienie oÅ¼yjÄ….</p>
<h1 id="i-faktyczna-animacja">â€¦i faktyczna animacja!</h1>
<p>Podstawowa idea jest taka, Å¼e kaÅ¼da kratka &ldquo;ogrzewa&rdquo; kratkÄ™ powyÅ¼ej. OczywiÅ›cie, ciepÅ‚o nie zostanie w 100% przeniesione, wiÄ™c bÄ™dziemy trochÄ™ zmniejszaÄ‡ poziom ciepÅ‚a ogrzewanych kratek. PrzejedÅºmy po wszystkich liniach poza ostatniÄ… (to bÄ™dzie palenisko bÄ™dÄ…ce ÅºrÃ³dÅ‚em ciepÅ‚a) i ustawmy poziom ciepÅ‚a na wartoÅ›Ä‡ o 1 mniejszÄ… niÅ¼ poziom kratki poniÅ¼ej:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-kotlin" data-lang="kotlin"><span style="display:flex;"><span><span style="color:#66d9ef">fun</span> <span style="color:#a6e22e">animujOgieÅ„</span>(ekran: MutableList&lt;MutableList&lt;Int&gt;&gt;) {
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">// dla kaÅ¼dej linijki oprÃ³cz ostatniej
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    <span style="color:#66d9ef">for</span> (y <span style="color:#66d9ef">in</span> <span style="color:#ae81ff">1.</span>.(WYSOKOSC - <span style="color:#ae81ff">1</span>)) {
</span></span><span style="display:flex;"><span>        <span style="color:#75715e">// dla kaÅ¼dego pikselka
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>        <span style="color:#66d9ef">for</span> (x <span style="color:#66d9ef">in</span> <span style="color:#ae81ff">1.</span>.SZEROKOSC) {
</span></span><span style="display:flex;"><span>            <span style="color:#75715e">// popatrz na kratkÄ™ poniÅ¼ej
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>            <span style="color:#66d9ef">val</span> kratkaPoniÅ¼ej = ekran[y][x - <span style="color:#ae81ff">1</span>]
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">val</span> nowaWartoÅ›Ä‡ = (kratkaPoniÅ¼ej - <span style="color:#ae81ff">1</span>).coerceAtLeast(<span style="color:#ae81ff">0</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>            <span style="color:#75715e">// ustaw nowÄ… wartoÅ›Ä‡ dla kratki
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>            ekran[y - <span style="color:#ae81ff">1</span>][x - <span style="color:#ae81ff">1</span>] = nowaWartoÅ›Ä‡
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p>Podobnie jak przy rysowaniu, skoro &ldquo;jedziemy&rdquo; po przedziaÅ‚ach <code>1..WYSOKOSC</code> i <code>1..SZEROKOSC</code>, piksel, ktÃ³rym obecnie siÄ™ zajmujemy to <code>ekran[y - 1][x - 1]</code>, a piksel poniÅ¼ej to <code>ekran[y - 1 + 1][x - 1]</code>, czyli po prostu <code>ekran[y][x - 1]</code>.</p>
<p>Musimy pamiÄ™taÄ‡ o tym, Å¼eby nie wstawiÄ‡ do <code>ekran</code>u Å¼adnej wartoÅ›ci ujemnej! Nasz &ldquo;poziom ciepÅ‚a&rdquo; zapisany dla kaÅ¼dej kratki <strong>musi</strong> byÄ‡ prawidÅ‚owym indeksem palety kolorÃ³w. Do tego wÅ‚aÅ›nie sÅ‚uÅ¼y wywoÅ‚anie <code>coerceAtLeast(0)</code>: <em>&ldquo;coerce&rdquo;</em> to po angielsku <em>&ldquo;wymuszaÄ‡&rdquo;</em>, zatem funkcja <code>Int.coerceAtLeast(0)</code> zapewni, Å¼e <code>nowaWartoÅ›Ä‡</code> nigdy nie bÄ™dzie ujemne:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-kotlin" data-lang="kotlin"><span style="display:flex;"><span><span style="color:#ae81ff">20.</span>coerceAtLeast(<span style="color:#ae81ff">0</span>)    <span style="color:#75715e">// 20
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>(-<span style="color:#ae81ff">15</span>).coerceAtLeast(<span style="color:#ae81ff">0</span>) <span style="color:#75715e">// 0
</span></span></span></code></pre></div><h1 id="doom-tÄ™cza">Doomâ€¦ tÄ™cza?</h1>
<p>Efekt dziaÅ‚ania tego programu nie jest zbyt ciekawy. Po pierwsze miaÅ‚ byÄ‡ ogieÅ„, a wyszÅ‚o coÅ› takiego:</p>
<p><img src="doom-tecza.png" alt="Doom tÄ™cza"></p>
<p>Po drugie, animacja okrutnie siÄ™ Å›limaczy, osiÄ…gamy co najwyÅ¼ej kilka klatek na sekundÄ™.</p>
<p>Na tym zakoÅ„czymy dzisiejsze zajÄ™cia. Na nastÄ™pnym spotkaniu zastanowimy siÄ™, czemu nasz program tak wolno dziaÅ‚a, a potem popracujemy nad ulepszeniem efektu animacji.</p>

</main>

  <footer>
  
  
  </footer>
  </body>
</html>

