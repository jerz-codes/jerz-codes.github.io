<!DOCTYPE html>
<html lang="pl-pl">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Zajƒôcia 16: Doom Fire | jerz.codes</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Roboto+Mono&family=Roboto:wght@400;700&display=swap">
    <link rel="stylesheet" href="/css/style.css" />
    <link rel="stylesheet" href="/css/fonts.css" />
    
  </head>

  <body>
    <nav>
    <ul class="menu">
      
      <li><a href="/">üè†</a></li>
      
      <li><a href="/zapisy/">Zapisy</a></li>
      
      <li><a href="/faq/">FAQ</a></li>
      
      <li><a href="/kontakt/">Kontakt</a></li>
      
    </ul>
    <hr/>
    </nav>

<div class="article-meta">
<h1><span class="title">Zajƒôcia 16: Doom Fire</span></h1>

<h2 class="date">2023/02/28</h2>
</div>

<main>
<div>
    <nav id="TableOfContents">
  <ul>
    <li><a href="#okienko">Okienko</a></li>
    <li><a href="#paleta-kolor√≥w">Paleta kolor√≥w</a></li>
    <li><a href="#model-danych">Model danych</a></li>
    <li><a href="#rysowanie-ekranu">Rysowanie ekranu</a></li>
    <li><a href="#pƒôtla-animacji">Pƒôtla animacji‚Ä¶</a></li>
    <li><a href="#i-faktyczna-animacja">‚Ä¶i faktyczna animacja!</a></li>
    <li><a href="#doom-tƒôcza">Doom‚Ä¶ tƒôcza?</a></li>
  </ul>
</nav>
</div>
<p>Na poprzednich zajƒôciach animowali≈õmy Matrix&rsquo;owy deszcz liter. Dzi≈õ pobawimy siƒô w piroman√≥w i napiszemy animacjƒô p≈Çomieni.</p>
<h1 id="okienko">Okienko</h1>
<p>Podobnie, jak przy Matrix&rsquo;owych animacjach, zaczniemy od narysowania pustego okienka. U≈ºyjemy sta≈Çych do okre≈õlenia szeroko≈õci i wysoko≈õci okna ‚Äì bƒôdziemy potrzebowaƒá tych warto≈õci p√≥≈∫niej. Do rysowania p≈Çomieni nie bƒôdziemy u≈ºywaƒá ≈ºadnych specjalnych znaczk√≥w. Zamiast tego bƒôdziemy wypisywaƒá r√≥≈ºnokolorowe spacje, a wiƒôc ka≈ºdy znak naszego terminala bƒôdzie osobnym pikselem (do≈õƒá sporym i prostokƒÖtnym, ale wciƒÖ≈º pikselem). Nasze okno powinno byƒá zatem du≈ºy, a rozmiar czcionki ‚Äì ma≈Çy:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-kotlin" data-lang="kotlin"><span style="display:flex;"><span><span style="color:#66d9ef">val</span> SZEROKOSC = <span style="color:#ae81ff">120</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">val</span> WYSOKOSC = <span style="color:#ae81ff">80</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">fun</span> <span style="color:#a6e22e">main</span>() = terminal(
</span></span><span style="display:flex;"><span>    widthInTiles = SZEROKOSC,
</span></span><span style="display:flex;"><span>    heightInTiles = WYSOKOSC,
</span></span><span style="display:flex;"><span>    fontSize = <span style="color:#ae81ff">8</span>
</span></span><span style="display:flex;"><span>) {
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><h1 id="paleta-kolor√≥w">Paleta kolor√≥w</h1>
<p>W przypadku Matrix&rsquo;owych animacji paletƒô kolor√≥w dla smug ciƒÖgnƒÖcych siƒô za spadajƒÖcymi tworzyli≈õmy samodzielnie. W dzisiejszym programie wykorzystamy paletƒô z gry Doom z 1993 roku. Mo≈ºecie wkleiƒá poni≈ºszy fragment przed funkcjƒÖ <code>main</code>:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-kotlin" data-lang="kotlin"><span style="display:flex;"><span><span style="color:#66d9ef">val</span> PALETA = listOf(
</span></span><span style="display:flex;"><span>    Color(<span style="color:#ae81ff">0x07</span>, <span style="color:#ae81ff">0x07</span>, <span style="color:#ae81ff">0x07</span>),
</span></span><span style="display:flex;"><span>    Color(<span style="color:#ae81ff">0x1f</span>, <span style="color:#ae81ff">0x07</span>, <span style="color:#ae81ff">0x07</span>),
</span></span><span style="display:flex;"><span>    Color(<span style="color:#ae81ff">0x2f</span>, <span style="color:#ae81ff">0x0f</span>, <span style="color:#ae81ff">0x07</span>),
</span></span><span style="display:flex;"><span>    Color(<span style="color:#ae81ff">0x47</span>, <span style="color:#ae81ff">0x0f</span>, <span style="color:#ae81ff">0x07</span>),
</span></span><span style="display:flex;"><span>    Color(<span style="color:#ae81ff">0x57</span>, <span style="color:#ae81ff">0x17</span>, <span style="color:#ae81ff">0x07</span>),
</span></span><span style="display:flex;"><span>    Color(<span style="color:#ae81ff">0x67</span>, <span style="color:#ae81ff">0x1f</span>, <span style="color:#ae81ff">0x07</span>),
</span></span><span style="display:flex;"><span>    Color(<span style="color:#ae81ff">0x77</span>, <span style="color:#ae81ff">0x1f</span>, <span style="color:#ae81ff">0x07</span>),
</span></span><span style="display:flex;"><span>    Color(<span style="color:#ae81ff">0x8f</span>, <span style="color:#ae81ff">0x27</span>, <span style="color:#ae81ff">0x07</span>),
</span></span><span style="display:flex;"><span>    Color(<span style="color:#ae81ff">0x9f</span>, <span style="color:#ae81ff">0x2f</span>, <span style="color:#ae81ff">0x07</span>),
</span></span><span style="display:flex;"><span>    Color(<span style="color:#ae81ff">0xaf</span>, <span style="color:#ae81ff">0x3f</span>, <span style="color:#ae81ff">0x07</span>),
</span></span><span style="display:flex;"><span>    Color(<span style="color:#ae81ff">0xbf</span>, <span style="color:#ae81ff">0x47</span>, <span style="color:#ae81ff">0x07</span>),
</span></span><span style="display:flex;"><span>    Color(<span style="color:#ae81ff">0xc7</span>, <span style="color:#ae81ff">0x47</span>, <span style="color:#ae81ff">0x07</span>),
</span></span><span style="display:flex;"><span>    Color(<span style="color:#ae81ff">0xDF</span>, <span style="color:#ae81ff">0x4F</span>, <span style="color:#ae81ff">0x07</span>),
</span></span><span style="display:flex;"><span>    Color(<span style="color:#ae81ff">0xDF</span>, <span style="color:#ae81ff">0x57</span>, <span style="color:#ae81ff">0x07</span>),
</span></span><span style="display:flex;"><span>    Color(<span style="color:#ae81ff">0xDF</span>, <span style="color:#ae81ff">0x57</span>, <span style="color:#ae81ff">0x07</span>),
</span></span><span style="display:flex;"><span>    Color(<span style="color:#ae81ff">0xD7</span>, <span style="color:#ae81ff">0x5F</span>, <span style="color:#ae81ff">0x07</span>),
</span></span><span style="display:flex;"><span>    Color(<span style="color:#ae81ff">0xD7</span>, <span style="color:#ae81ff">0x67</span>, <span style="color:#ae81ff">0x0F</span>),
</span></span><span style="display:flex;"><span>    Color(<span style="color:#ae81ff">0xcf</span>, <span style="color:#ae81ff">0x6f</span>, <span style="color:#ae81ff">0x0f</span>),
</span></span><span style="display:flex;"><span>    Color(<span style="color:#ae81ff">0xcf</span>, <span style="color:#ae81ff">0x77</span>, <span style="color:#ae81ff">0x0f</span>),
</span></span><span style="display:flex;"><span>    Color(<span style="color:#ae81ff">0xcf</span>, <span style="color:#ae81ff">0x7f</span>, <span style="color:#ae81ff">0x0f</span>),
</span></span><span style="display:flex;"><span>    Color(<span style="color:#ae81ff">0xCF</span>, <span style="color:#ae81ff">0x87</span>, <span style="color:#ae81ff">0x17</span>),
</span></span><span style="display:flex;"><span>    Color(<span style="color:#ae81ff">0xC7</span>, <span style="color:#ae81ff">0x87</span>, <span style="color:#ae81ff">0x17</span>),
</span></span><span style="display:flex;"><span>    Color(<span style="color:#ae81ff">0xC7</span>, <span style="color:#ae81ff">0x8F</span>, <span style="color:#ae81ff">0x17</span>),
</span></span><span style="display:flex;"><span>    Color(<span style="color:#ae81ff">0xC7</span>, <span style="color:#ae81ff">0x97</span>, <span style="color:#ae81ff">0x1F</span>),
</span></span><span style="display:flex;"><span>    Color(<span style="color:#ae81ff">0xBF</span>, <span style="color:#ae81ff">0x9F</span>, <span style="color:#ae81ff">0x1F</span>),
</span></span><span style="display:flex;"><span>    Color(<span style="color:#ae81ff">0xBF</span>, <span style="color:#ae81ff">0x9F</span>, <span style="color:#ae81ff">0x1F</span>),
</span></span><span style="display:flex;"><span>    Color(<span style="color:#ae81ff">0xBF</span>, <span style="color:#ae81ff">0xA7</span>, <span style="color:#ae81ff">0x27</span>),
</span></span><span style="display:flex;"><span>    Color(<span style="color:#ae81ff">0xBF</span>, <span style="color:#ae81ff">0xA7</span>, <span style="color:#ae81ff">0x27</span>),
</span></span><span style="display:flex;"><span>    Color(<span style="color:#ae81ff">0xBF</span>, <span style="color:#ae81ff">0xAF</span>, <span style="color:#ae81ff">0x2F</span>),
</span></span><span style="display:flex;"><span>    Color(<span style="color:#ae81ff">0xB7</span>, <span style="color:#ae81ff">0xAF</span>, <span style="color:#ae81ff">0x2F</span>),
</span></span><span style="display:flex;"><span>    Color(<span style="color:#ae81ff">0xB7</span>, <span style="color:#ae81ff">0xB7</span>, <span style="color:#ae81ff">0x2F</span>),
</span></span><span style="display:flex;"><span>    Color(<span style="color:#ae81ff">0xB7</span>, <span style="color:#ae81ff">0xB7</span>, <span style="color:#ae81ff">0x37</span>),
</span></span><span style="display:flex;"><span>    Color(<span style="color:#ae81ff">0xCF</span>, <span style="color:#ae81ff">0xCF</span>, <span style="color:#ae81ff">0x6F</span>),
</span></span><span style="display:flex;"><span>    Color(<span style="color:#ae81ff">0xDF</span>, <span style="color:#ae81ff">0xDF</span>, <span style="color:#ae81ff">0x9F</span>),
</span></span><span style="display:flex;"><span>    Color(<span style="color:#ae81ff">0xEF</span>, <span style="color:#ae81ff">0xEF</span>, <span style="color:#ae81ff">0xC7</span>),
</span></span><span style="display:flex;"><span>    Color(<span style="color:#ae81ff">0xFF</span>, <span style="color:#ae81ff">0xFF</span>, <span style="color:#ae81ff">0xFF</span>),
</span></span><span style="display:flex;"><span>)
</span></span></code></pre></div><h1 id="model-danych">Model danych</h1>
<p>Dla ka≈ºdego &ldquo;piksela&rdquo; na naszym ekranie bƒôdziemy przechowywaƒá jej &ldquo;poziom ciep≈Ça&rdquo;: liczbƒô od 0 do 35. Te liczby nie wziƒô≈Çy siƒô z kosmosu: mamy dok≈Çadnie 36 barw w naszej palecie, wiƒôc liczby <code>0..35</code> odpowiadajƒÖ indeksom w tej tablicy. Poziom <code>0</code> oznacza prawie ca≈Çkowicie wygaszonƒÖ kratkƒô, poziom <code>35</code> to kratka roz≈ºarzona do bia≈Ço≈õci.</p>
<p>Proponujƒô przechowywaƒá te dane w zagnie≈ºd≈ºonej li≈õcie, tj.: li≈õcie linijek, gdzie ka≈ºda linijka to lista poziom√≥w ciep≈Ça kratek w tej linii:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-kotlin" data-lang="kotlin"><span style="display:flex;"><span><span style="color:#66d9ef">val</span> ekran: MutableList&lt;MutableList&lt;Int&gt;&gt;
</span></span></code></pre></div><p>PoczƒÖtkowo musimy wype≈Çniƒá wszystkie kratki warto≈õciƒÖ <code>0</code>, poza dolnƒÖ liniƒÖ, kt√≥rƒÖ wype≈Çnimy warto≈õciami <code>35</code>. Bƒôdzie to ≈∫r√≥d≈Ço ciep≈Ça i p≈Çomieni.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-kotlin" data-lang="kotlin"><span style="display:flex;"><span><span style="color:#66d9ef">for</span> (y <span style="color:#66d9ef">in</span> <span style="color:#ae81ff">1.</span>.WYSOKOSC) {
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">val</span> linijka = mutableListOf&lt;Int&gt;()
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">for</span> (x <span style="color:#66d9ef">in</span> <span style="color:#ae81ff">1.</span>.SZEROKOSC) {
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">val</span> pikselek = <span style="color:#66d9ef">if</span> (y <span style="color:#f92672">==</span> WYSOKOSC) <span style="color:#a6e22e">PALETA</span>.lastIndex <span style="color:#66d9ef">else</span> <span style="color:#ae81ff">0</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        linijka.add(pikselek)
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    ekran.add(linijka)
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p>W powy≈ºszym fragmencie kodu sƒÖ dwie rzeczy, na kt√≥re chcia≈Çbym zwr√≥ciƒá waszƒÖ uwagƒô.</p>
<p>Po pierwsze, dla ostatniej linijki zamiast po prostu warto≈õci <code>35</code> u≈ºywamy w≈Çasno≈õci <code>PALETA.lastIndex</code>, czyli odpytujemy paletƒô barw o indeks ostatniego koloru. Dziƒôki temu nawet po zmianie palety nasz program bƒôdzie dzia≈Ça≈Ç poprawnie.</p>
<p>Po drugie, do sta≈Çej <code>val pikselek</code> przypisujemy&hellip; <code>if..else</code>&lsquo;a? Taki manewr nie jest dozwolony w wielu jƒôzykach programowania, ale akurat w Kotlinie <code>if..else</code> oraz <code>when</code> sƒÖ <strong>wyra≈ºeniami</strong>, czyli mo≈ºna ich u≈ºywaƒá wszƒôdzie tam, gdzie spodziewaliby≈õmy siƒô wywo≈Çania funkcji, u≈ºycia sta≈Çej lub zmiennej, albo po prostu sta≈Çej warto≈õci wpisanej bezpo≈õrednio w kodzie.</p>
<h1 id="rysowanie-ekranu">Rysowanie ekranu</h1>
<p>Skoro mamy ju≈º przygotowane dane dla ca≈Çego ekranu, czas wyrysowaƒá wszystko. Co prawda nie bƒôdziemy jeszcze nic animowaƒá, ale nauczeni do≈õwiadczeniem z tworzenia poprzednich animacji, zastosujemy trik z <code>kartkƒÖ</code> i pojedynczym <code>print</code>, aby uniknƒÖƒá p√≥≈∫niej mrugania ekranu:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-kotlin" data-lang="kotlin"><span style="display:flex;"><span><span style="color:#66d9ef">var</span> kartka = <span style="color:#e6db74">&#34;&#34;</span>
</span></span><span style="display:flex;"><span>kartka <span style="color:#f92672">+=</span> <span style="color:#a6e22e">Ansi</span>.wyczy≈õƒáEkran()
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">for</span> (y <span style="color:#66d9ef">in</span> <span style="color:#ae81ff">1.</span>.WYSOKOSC) {
</span></span><span style="display:flex;"><span>    kartka <span style="color:#f92672">+=</span> <span style="color:#a6e22e">Ansi</span>.przesu≈ÑKursor(<span style="color:#ae81ff">1</span>, y)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">val</span> linijka = ekran[y - <span style="color:#ae81ff">1</span>]
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">for</span> (x <span style="color:#66d9ef">in</span> <span style="color:#ae81ff">1.</span>.SZEROKOSC) {
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">val</span> pikselek = linijka[x - <span style="color:#ae81ff">1</span>]
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">val</span> kolorPiksela = PALETA[pikselek]
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        kartka <span style="color:#f92672">+=</span> <span style="color:#a6e22e">Ansi</span>.kolorT≈Ça(kolorPiksela)
</span></span><span style="display:flex;"><span>        kartka <span style="color:#f92672">+=</span> <span style="color:#e6db74">&#39; &#39;</span>
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>print(kartka)
</span></span></code></pre></div><p>Wypisujemy ekran linijka po linijce, dla ka≈ºdej linijki najpierw przechodzƒÖc na jej poczƒÖtek przy u≈ºyciu <code>Ansi.przesu≈ÑKursor</code>, a potem rysujƒÖc r√≥≈ºnokolorowƒÖ spacjƒô dla ka≈ºdego pikselka w linijce. Je≈õli nie macie w swojej klasie <code>Ansi</code> metody <code>kolorT≈Ça</code>, wr√≥ƒácie do materia≈Ç√≥w z <a href="https://jerz.codes/posts/2022-12-20/">zajƒôƒá nr 9</a>.</p>
<p>Zauwa≈ºcie te≈º, ≈ºe pobierajƒÖc linijkƒô z listy <code>ekran</code> albo piksel z linijki, musimy od <code>y</code> i <code>x</code> odjƒÖƒá <code>1</code>. Listy indeksowane sƒÖ od <code>0</code>, a wiƒôc dla pierwszego wiersza, czyli dla <code>y</code> r√≥wnego <code>1</code>, musimy pobraƒá <code>0</code>-wy element.</p>
<p>Po uruchomieniu programu powinni≈õcie zobaczyƒá czarne okienko z bia≈ÇƒÖ kreskƒÖ na dole:</p>
<p><img src="doom-kreska.png" alt="Doom kreska"></p>
<h1 id="pƒôtla-animacji">Pƒôtla animacji‚Ä¶</h1>
<p>Skoro mamy co≈õ animowaƒá, opakujmy rysowanie ekranu w pƒôtlƒô:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-kotlin" data-lang="kotlin"><span style="display:flex;"><span><span style="color:#66d9ef">do</span> {
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">var</span> kartka = <span style="color:#e6db74">&#34;&#34;</span>
</span></span><span style="display:flex;"><span>    kartka <span style="color:#f92672">+=</span> <span style="color:#a6e22e">Ansi</span>.wyczy≈õƒáEkran()
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">for</span> (y <span style="color:#66d9ef">in</span> <span style="color:#ae81ff">1.</span>.WYSOKOSC) {
</span></span><span style="display:flex;"><span>        kartka <span style="color:#f92672">+=</span> <span style="color:#a6e22e">Ansi</span>.przesu≈ÑKursor(<span style="color:#ae81ff">1</span>, y)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">val</span> linijka = ekran[y - <span style="color:#ae81ff">1</span>]
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">for</span> (x <span style="color:#66d9ef">in</span> <span style="color:#ae81ff">1.</span>.SZEROKOSC) {
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">val</span> pikselek = linijka[x - <span style="color:#ae81ff">1</span>]
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">val</span> kolorPiksela = PALETA[pikselek]
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>            kartka <span style="color:#f92672">+=</span> <span style="color:#a6e22e">Ansi</span>.kolorT≈Ça(kolorPiksela)
</span></span><span style="display:flex;"><span>            kartka <span style="color:#f92672">+=</span> <span style="color:#e6db74">&#39; &#39;</span>
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    print(kartka)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">Thread</span>.sleep(<span style="color:#ae81ff">16</span>)
</span></span><span style="display:flex;"><span>    animujOgie≈Ñ(ekran)
</span></span><span style="display:flex;"><span>} <span style="color:#66d9ef">while</span> (<span style="color:#66d9ef">true</span>)
</span></span></code></pre></div><p>Po wyrysowaniu kartki doda≈Çem op√≥≈∫nienie przy u≈ºyciu funkcji <code>Thread.sleep(‚Ä¶)</code>. U≈ºyta warto≈õƒá <code>16</code> milisekund bierze siƒô z czƒôstotliwo≈õci od≈õwie≈ºania ekranu 99% nie-gameing&rsquo;owych monitor√≥w, kt√≥re sƒÖ w stanie wy≈õwietliƒá 60 klatek na sekundƒô (<code>1000ms / 60 = 16.66(7)ms</code>). Nie ma sensu czƒô≈õciej wywo≈Çywaƒá <code>print(kartka)</code> ‚Äì monitor i tak nie bƒôdzie w stanie tego wy≈õwietliƒá.</p>
<p>Ostatnia rzecz w g≈Ç√≥wnej pƒôtli animacji to wywo≈Çanie funkcji <code>animujOgie≈Ñ</code>. To w≈Ça≈õnie ona bƒôdzie &ldquo;sercem&rdquo; naszego programu. Przeka≈ºemy tam <code>ekran</code> i wewnƒÖtrz tej funkcji bƒôdziemy dokonywaƒá w nim zmian, kt√≥re sprawiƒÖ, ≈ºe nasze p≈Çomienie o≈ºyjƒÖ.</p>
<h1 id="i-faktyczna-animacja">‚Ä¶i faktyczna animacja!</h1>
<p>Podstawowa idea jest taka, ≈ºe ka≈ºda kratka &ldquo;ogrzewa&rdquo; kratkƒô powy≈ºej. Oczywi≈õcie, ciep≈Ço nie zostanie w 100% przeniesione, wiƒôc bƒôdziemy trochƒô zmniejszaƒá poziom ciep≈Ça ogrzewanych kratek. Przejed≈∫my po wszystkich liniach poza ostatniƒÖ (to bƒôdzie palenisko bƒôdƒÖce ≈∫r√≥d≈Çem ciep≈Ça) i ustawmy poziom ciep≈Ça na warto≈õƒá o 1 mniejszƒÖ ni≈º poziom kratki poni≈ºej:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-kotlin" data-lang="kotlin"><span style="display:flex;"><span><span style="color:#66d9ef">fun</span> <span style="color:#a6e22e">animujOgie≈Ñ</span>(ekran: MutableList&lt;MutableList&lt;Int&gt;&gt;) {
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">// dla ka≈ºdej linijki opr√≥cz ostatniej
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    <span style="color:#66d9ef">for</span> (y <span style="color:#66d9ef">in</span> <span style="color:#ae81ff">1.</span>.(WYSOKOSC - <span style="color:#ae81ff">1</span>)) {
</span></span><span style="display:flex;"><span>        <span style="color:#75715e">// dla ka≈ºdego pikselka
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>        <span style="color:#66d9ef">for</span> (x <span style="color:#66d9ef">in</span> <span style="color:#ae81ff">1.</span>.SZEROKOSC) {
</span></span><span style="display:flex;"><span>            <span style="color:#75715e">// popatrz na kratkƒô poni≈ºej
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>            <span style="color:#66d9ef">val</span> kratkaPoni≈ºej = ekran[y][x - <span style="color:#ae81ff">1</span>]
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">val</span> nowaWarto≈õƒá = (kratkaPoni≈ºej - <span style="color:#ae81ff">1</span>).coerceAtLeast(<span style="color:#ae81ff">0</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>            <span style="color:#75715e">// ustaw nowƒÖ warto≈õƒá dla kratki
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>            ekran[y - <span style="color:#ae81ff">1</span>][x - <span style="color:#ae81ff">1</span>] = nowaWarto≈õƒá
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p>Podobnie jak przy rysowaniu, skoro &ldquo;jedziemy&rdquo; po przedzia≈Çach <code>1..WYSOKOSC</code> i <code>1..SZEROKOSC</code>, piksel, kt√≥rym obecnie siƒô zajmujemy to <code>ekran[y - 1][x - 1]</code>, a piksel poni≈ºej to <code>ekran[y - 1 + 1][x - 1]</code>, czyli po prostu <code>ekran[y][x - 1]</code>.</p>
<p>Musimy pamiƒôtaƒá o tym, ≈ºeby nie wstawiƒá do <code>ekran</code>u ≈ºadnej warto≈õci ujemnej! Nasz &ldquo;poziom ciep≈Ça&rdquo; zapisany dla ka≈ºdej kratki <strong>musi</strong> byƒá prawid≈Çowym indeksem palety kolor√≥w. Do tego w≈Ça≈õnie s≈Çu≈ºy wywo≈Çanie <code>coerceAtLeast(0)</code>: <em>&ldquo;coerce&rdquo;</em> to po angielsku <em>&ldquo;wymuszaƒá&rdquo;</em>, zatem funkcja <code>Int.coerceAtLeast(0)</code> zapewni, ≈ºe <code>nowaWarto≈õƒá</code> nigdy nie bƒôdzie ujemne:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-kotlin" data-lang="kotlin"><span style="display:flex;"><span><span style="color:#ae81ff">20.</span>coerceAtLeast(<span style="color:#ae81ff">0</span>)    <span style="color:#75715e">// 20
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>(-<span style="color:#ae81ff">15</span>).coerceAtLeast(<span style="color:#ae81ff">0</span>) <span style="color:#75715e">// 0
</span></span></span></code></pre></div><h1 id="doom-tƒôcza">Doom‚Ä¶ tƒôcza?</h1>
<p>Efekt dzia≈Çania tego programu nie jest zbyt ciekawy. Po pierwsze mia≈Ç byƒá ogie≈Ñ, a wysz≈Ço co≈õ takiego:</p>
<p><img src="doom-tecza.png" alt="Doom tƒôcza"></p>
<p>Po drugie, animacja okrutnie siƒô ≈õlimaczy, osiƒÖgamy co najwy≈ºej kilka klatek na sekundƒô.</p>
<p>Na tym zako≈Ñczymy dzisiejsze zajƒôcia. Na nastƒôpnym spotkaniu zastanowimy siƒô, czemu nasz program tak wolno dzia≈Ça, a potem popracujemy nad ulepszeniem efektu animacji.</p>

</main>

  <footer>
  
  
  </footer>
  </body>
</html>

